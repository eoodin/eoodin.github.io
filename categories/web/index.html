<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Category: web | 知行悟</title>
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/">
  <link rel="alternate" href="/atom.xml" title="知行悟">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="知行悟">
<meta property="og:url" content="https://eoodin.github.io/categories/web/index.html">
<meta property="og:site_name" content="知行悟">
<meta property="og:locale" content="zh_CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="知行悟">
    
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>

<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				知行悟
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/'>
								Home
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/archives'>
								Archives
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/about'>
								About
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search flat-box"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu flat-box"></span></a></li>
			</ul>
		</div>
		
		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				Word of Forks
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a href='javascript:void(0)'><span class="icon icon-chat_bubble_outline flat-box"></span></a></li>
				<li class='s-top'><a href='javascript:void(0)'><span class="icon icon-arrow_upward flat-box"></span></a></li>
				<li class='s-toc'><a href='javascript:void(0)'><span class="icon icon-format_list_numbered flat-box"></span></a></li>
			</ul>
		</div>
	</div>
</header>
<aside class="menu-phone">
	<nav>
		
			<a href="/" class="nav-home nav">
				Home
			</a>
		
			<a href="/archives" class="nav-archives nav">
				Archives
			</a>
		
			<a href="/about" class="nav-about nav">
				About
			</a>
		
	</nav>
</aside>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container clearfix'>
      <div class='l_main'>
        
  <script>
    window.subData= { title:'Category : web'}
  </script>

<section class="post-list">
	
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2017/10/28/why-tdd-is-difficult/">
        Why TDD is difficult
      </a>
    </h2>
    
    <time>
      10月 28, 2017
    </time>
		
    
    <div class='cats'>
        <a href="/categories/web/">web</a>
    </div>

  </section>
  <section class="article typo">
	  <h1 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h1><p>Comparing with the the way that develop a software without unit test, there are couple of extra topics on table when doing test driven development.</p>
<h2 id="Testing-harness"><a href="#Testing-harness" class="headerlink" title="Testing harness"></a>Testing harness</h2><p>Testing harness vary from techniques, because of that most of us will no long write test harness for ourselves in order to save effort and to utilize rich features already made by other people, we have to learn a unit test framework for each technique we touched.</p>
<p>I faced two problems after I stepped in JavaScript world, the first is what I touched is too much as a bundle including many technologies new to me. I spent considerable time on getting me clearer, however, when writing unit test for a software based on those, I have to understand what can I do with those dependencies. Another problem is that there are two sub types of the technologies, TypeScript for frontend and javascript for backend, they require different setup. For frontend, Angular already shipped with its own testing harness out of the box, but javascript does not.</p>
<h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><p>It is usually hard to manage dependencies will in unit tests, especially for those SUT which is not well designed. It took much time to get me comfortable with the way to have interfaces ready before I could write any implementation. I suppose the same issue will be there in any technology that new to me.</p>
<h1 id="Mental-model"><a href="#Mental-model" class="headerlink" title="Mental model"></a>Mental model</h1><p>I am not willing to admit the fact that I go to production code without writing any unit test just because the effect of production code give me feedback I wanted for ensuring I am making progress.</p>
<p>Even I could realize that is not correct way, I can easily get in the state. I think the feedback I am expecting will be not that necessary to my brain when I am getting familiar with the technology. So I suppose after playing with Angular couple of months there is a timing that I could turn things on track.</p>
<h2 id="Fear"><a href="#Fear" class="headerlink" title="Fear"></a>Fear</h2><p>TDD forced us as developer to think carefully before we could write a single line of production code. But I have been working in casual way for long time, even I understand that the total effort of production code first approach will be higher that TDD approach, It turns into habitual old approach easily. I think the cause for this pattern should be fear, I was afraid of being working on writing tests even design the SUT for long time. </p>
<p>I experienced couple of cases while writing unit tests, I found the design needs to be redone after some of unit tests and their production code ready, this was far from refactoring. On contrast, directly writing production code gave me the feeling that I will waste less when I fall into this kind of situation.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>I still believe that TDD is a better approach of software development than direct coding, or later unit tests approach, but TDD is feasible only following criteria met:</p>
<ul>
<li><p>The SUT is well designed, or could be well designed</p>
</li>
<li><p>Developer needs to be familiar with the technology been used</p>
</li>
<li><p>Test harness needs to be handy for developers.</p>
</li>
</ul>


    
    
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2017/10/27/angular-testing/">
        Angular测试
      </a>
    </h2>
    
    <time>
      10月 27, 2017
    </time>
		
    
    <div class='cats'>
        <a href="/categories/web/">web</a>
    </div>

  </section>
  <section class="article typo">
	  <h1 id="Angular测试四大件"><a href="#Angular测试四大件" class="headerlink" title="Angular测试四大件"></a>Angular测试四大件</h1><p>今年以来Angular变化很多，比较大的一个变化就是文档的质量相比去年有了很大的提高，因此如果是需要系统地学习Angular测试，看官网的帮助是一个最好的选择，它还在不断地更新。这里主要是为了记录一下在为Shelf添加测试的过程和遇到的问题，以备参考。</p>
<p>这里说的是测试，官方文档就是说的测试，包含了单元测试和端到端测试，其中单元测试需要用到的东西有：</p>
<ul>
<li><p>Karma 这是JavaScript项目常用的单元测试的运行器</p>
</li>
<li><p>Jasmine 这是JavaScript项目广泛采用的单元测试框架，它是一个BDD的框架</p>
</li>
<li><p>Angular测试工具集　这是真正Angular提供用于帮助测试的东西</p>
</li>
</ul>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>Angular 今年在 @angular/cli　上投入很多，现在官网很多教程都已经采用cli来说明，Shelf也在很早以前就使用cli来管理代码，淌过不少坑。<br>基于CLI的测试准备也相当简单，如果是ng new出来的项目，自动就设置好了，只需要在app/src下写*.spec.ts就可以跑了。</p>
<h1 id="测试类型"><a href="#测试类型" class="headerlink" title="测试类型"></a>测试类型</h1><p>Angular 把测试分为两类，一类是跟Angular机制无关的，比如Service, Pipe，这类被测对象应该是简单的TypeScript的对象，我们只需按照一般的测试写就行了不需要用到上面列出的Angular测试工具集。另一类就比较麻烦了，比如Directive, Component这类，因为它们的测试点往往依赖Angular的Change Detection，HTML渲染等。</p>
<h2 id="Angular测试工具集"><a href="#Angular测试工具集" class="headerlink" title="Angular测试工具集"></a>Angular测试工具集</h2><p>测试工具集提供这些功能</p>
<p><strong>TestBed</strong></p>
<p>用于创建一个用于测试的NgModule环境</p>
<p><strong>ComponentFixture</strong></p>
<p>使用TestBed创建出来的被测对象的封装</p>
<ul>
<li>.componentInstance即被测对象，　</li>
<li>.debugElement提供一个操作被测对象的接口，比如检查元素状态</li>
<li>.debugElement.injector.get(UserService)获取injector</li>
<li>.detectChanges可以手动检测变动，如果不调用变动不会有效果</li>
<li>.compileCompoennts　配合async可以正常处理外部template和style的component</li>
</ul>
<p><strong>ComponentFixtureAutoDetect</strong></p>
<p>配置TestBed时将之放入provider里，除直接修改component field不生效外，可以实现自动Change Detection（因为它hook timer等async调用）</p>
<p><strong>async</strong> 把传beforeEach setup包上async，框架会把它测试放入一个zone，异步执行后续的boforeEach和测试</p>
<h1 id="Angular模块测试"><a href="#Angular模块测试" class="headerlink" title="Angular模块测试"></a>Angular模块测试</h1><h2 id="处理依赖"><a href="#处理依赖" class="headerlink" title="处理依赖"></a>处理依赖</h2><pre>
 TestBed.configureTestingModule({
    declarations: [ WelcomeComponent ],
 // providers:    [ UserService ]  // NO! Don't provide the real service!
                                   // Provide a test-double instead
    providers:    [ {provide: UserService, useValue: userServiceStub } ]
 });
</pre>

<h2 id="访问依赖"><a href="#访问依赖" class="headerlink" title="访问依赖"></a>访问依赖</h2><p>被注入的依赖是一个clone，访问useValue的直接引用没有效果</p>
<p>TBC..</p>


    
    
    
  </section>
</article>
    </div>
  
</section>


      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<div class='header'>建哥</div>
<div class='content'>
<div class='desc'>Tempora mutantur, nos et mutamur in illis ...</div>
</div>
</section>

  <section class='m_widget links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="https://www.infoq.com/">
            <div class='name'>InfoQ</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://www.cncf.io/">
            <div class='name'>CNCF</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/calligraphy/"><div class='name'>calligraphy</div><div class='badget'>2</div></a></li>
    
        <li><a class="flat-box" href="/categories/web/"><div class='name'>web</div><div class='badget'>2</div></a></li>
    
    </ul>
    
</div>
</section>

  


      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/eoodin" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="https://twitter.com/eoodin" class="social twitter"
          target="_blank" rel="external">
          <span class="icon icon-twitter"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
